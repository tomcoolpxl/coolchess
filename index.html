<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>coolChess</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="overlay" id="overlay" onclick="handleOverlayClick()"></div>

    <div class="game-over" id="gameOver">
        <h2 id="gameOverTitle">Game Over</h2>
        <p id="gameOverMessage"></p>
        <button onclick="newGame()" aria-label="Start a new game">New Game</button>
    </div>

    <div class="promotion-dialog" id="promotionDialog">
        <h3>Choose a piece to promote to:</h3>
        <div class="promotion-pieces" id="promotionPieces"></div>
    </div>

    <div class="info-dialog" id="infoDialog">
        <h2>How coolChess Works</h2>
        <div class="info-content">
            <h3>Minimax Algorithm</h3>
            <p>The AI uses the minimax algorithm with alpha-beta pruning to evaluate moves.</p>
            <p>The algorithm works by:</p>
            <ul>
                <li>Generating all possible legal moves from the current position</li>
                <li>For each move, simulating the opponent's best response</li>
                <li>Recursively evaluating positions to a specified depth</li>
                <li>Scoring positions based on material count and piece positioning</li>
                <li>Selecting the move that maximizes the AI's position while minimizing yours</li>
            </ul>
            <p>Difficulty levels control search depth. Higher depth means the AI evaluates more moves ahead but takes longer to compute. Depth 1 evaluates only immediate moves. Depth 4 searches four moves into the future.</p>

            <h3>Opening Book</h3>
            <p>The first 2-3 moves use a pre-programmed opening book instead of calculation.</p>
            <p>Programmed moves:</p>
            <ul>
                <li>White's first move: 4 options (e4, d4, c4, Nf3)</li>
                <li>Black's response to e4: 4 options (e5, c5, e6, c6)</li>
                <li>Black's response to d4: 3 options (d5, Nf6, f6)</li>
            </ul>
            <p>Total: 11 pre-programmed moves. The AI randomly selects from available options.</p>
        </div>
        <button onclick="closeInfo()">Close</button>
    </div>

    <div class="mobile-menu" id="mobileMenu">
        <h2>Menu</h2>
        <div class="mobile-menu-content" onclick="event.stopPropagation()">
            <h3>Game Mode</h3>
            <div class="mode-buttons">
                <button id="mobileModeBtn-pvp" onclick="setMode('pvp'); closeMobileMenu()" aria-label="Play against another human player">Player vs Player</button>
                <button id="mobileModeBtn-ai" class="active" onclick="setMode('ai'); closeMobileMenu()" aria-label="Play against the AI">Player vs AI</button>
            </div>
            <button id="mobileModeBtn-watch" onclick="setMode('watch'); closeMobileMenu()" style="margin-top: 10px;" aria-label="Watch two AIs play against each other">Watch AI vs AI</button>

            <h3 style="margin-top: 20px;">AI Difficulty</h3>
            <div id="mobileSingleAIDifficulty">
                <select id="mobileDifficulty" onchange="updateMobileDifficulty()">
                    <option value="1">Beginner (Depth 1)</option>
                    <option value="2" selected>Easy (Depth 2)</option>
                    <option value="3">Medium (Depth 3)</option>
                    <option value="4">Hard (Depth 4)</option>
                </select>
            </div>
            <div id="mobileWatchAIDifficulty" style="display: none;">
                <div style="margin-bottom: 10px;">
                    <label style="font-size: 13px; font-weight: bold; display: block; margin-bottom: 5px;">White AI:</label>
                    <select id="mobileDifficultyWhite" onchange="updateMobileDifficultyWhite()">
                        <option value="1">Beginner (Depth 1)</option>
                        <option value="2" selected>Easy (Depth 2)</option>
                        <option value="3">Medium (Depth 3)</option>
                        <option value="4">Hard (Depth 4)</option>
                    </select>
                </div>
                <div>
                    <label style="font-size: 13px; font-weight: bold; display: block; margin-bottom: 5px;">Black AI:</label>
                    <select id="mobileDifficultyBlack" onchange="updateMobileDifficultyBlack()">
                        <option value="1">Beginner (Depth 1)</option>
                        <option value="2" selected>Easy (Depth 2)</option>
                        <option value="3">Medium (Depth 3)</option>
                        <option value="4">Hard (Depth 4)</option>
                    </select>
                </div>
                <div id="mobileWatchControls" style="margin-top: 15px; display: flex; gap: 5px;">
                    <button id="mobileStartWatchBtn" onclick="startWatchMatch()" style="flex: 1; padding: 12px; font-size: 14px; min-height: 44px;">Start Match</button>
                    <button id="mobilePauseWatchBtn" onclick="pauseWatchMatch()" style="flex: 1; padding: 12px; font-size: 14px; min-height: 44px; display: none;">Pause</button>
                    <button id="mobileStopWatchBtn" onclick="stopWatchMatch()" style="flex: 1; padding: 12px; font-size: 14px; min-height: 44px; display: none;">Stop</button>
                </div>
            </div>

            <h3 style="margin-top: 20px;">Settings</h3>
            <div class="checkbox-container">
                <input type="checkbox" id="mobileShowLegalMoves" checked onchange="toggleMobileLegalMoves()">
                <label for="mobileShowLegalMoves">Show Legal Moves</label>
            </div>

            <h3 style="margin-top: 20px;">Move History</h3>
            <div class="move-history" id="mobileMoveHistory"></div>
        </div>
        <button onclick="closeMobileMenu()" style="margin-top: 20px;">Close</button>
    </div>

    <div class="mobile-header" id="mobileHeader">
        <div class="mobile-header-top">
            <button class="mobile-menu-btn" onclick="openMobileMenu()" aria-label="Open menu">â˜°</button>
            <div class="mobile-title">coolChess</div>
            <button class="mobile-info-btn" onclick="showInfo()" aria-label="Show information about how the AI works">i</button>
        </div>
        <div class="mobile-status-bar">
            <div class="status" id="mobileStatus">White's Turn</div>
            <button class="mobile-new-game-btn" onclick="newGame()" aria-label="Start a new game">New Game</button>
        </div>
        <div class="ai-thinking" id="mobileAiThinking">
            <div class="ai-thinking-spinner"></div>
            <div class="ai-thinking-text" id="mobileAiThinkingText">AI is thinking...</div>
        </div>
    </div>

    <div class="container">
        <div class="board-container">
            <div class="board-wrapper">
                <div style="position: relative;">
                    <div class="evaluation-bar">
                        <div class="eval-fill" id="evalFill"></div>
                        <div class="eval-text" id="evalText">0.0</div>
                    </div>
                    <div style="position: absolute; left: -30px; top: 5px; font-size: 11px; font-weight: bold; color: #f0f0f0; text-shadow: 1px 1px 2px rgba(0,0,0,0.8);">W</div>
                    <div style="position: absolute; left: -30px; bottom: 5px; font-size: 11px; font-weight: bold; color: #333;">B</div>
                </div>
                <div class="board-with-coords">
                    <svg class="move-arrow-svg" id="moveArrowSvg">
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                <polygon points="0 0, 10 3, 0 6" fill="rgba(255, 170, 0, 0.8)" />
                            </marker>
                        </defs>
                    </svg>
                    <div class="chessboard" id="chessboard"></div>
                </div>
            </div>

            <!-- Controls below board -->
            <div class="board-controls">
                <div class="control-section">
                    <h3>Quick Actions</h3>
                    <div class="button-row">
                        <button id="undoBtn" onclick="undoMove()" aria-label="Undo last two moves">Undo Move</button>
                        <button id="hintBtn" onclick="getHint()" aria-label="Get AI hint for best move">Get Hint</button>
                    </div>
                    <div class="hint-text" id="hintText" style="display: none;"></div>
                </div>

                <div class="control-section">
                    <h3>Captured Pieces</h3>
                    <div class="captured-container">
                        <div class="captured-row">
                            <strong>By White:</strong>
                            <div class="captured-pieces" id="whiteCaptured"></div>
                        </div>
                        <div class="captured-row">
                            <strong>By Black:</strong>
                            <div class="captured-pieces" id="blackCaptured"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="sidebar-title">
                coolChess
                <button class="info-button" onclick="showInfo()" title="How it works" aria-label="Show information about how the AI works">i</button>
            </div>

            <div class="panel">
                <h2>Game Status</h2>
                <div class="status" id="status">White's Turn</div>
                <div class="move-counter" id="moveCounter">Move: 1 | Halfmove: 0</div>
                <div class="ai-thinking" id="aiThinking">
                    <div class="ai-thinking-spinner"></div>
                    <div class="ai-thinking-text" id="aiThinkingText">AI is thinking...</div>
                </div>
                <div style="font-size: 12px; color: #666; margin: 10px 0; padding: 8px; background: #f5f5f5; border-radius: 5px;">
                    <strong>Eval Bar:</strong> White area (W) fills up when White is winning, Black area (B) fills when Black is winning. Number shows advantage.
                </div>
                <div class="move-history" id="moveHistory"></div>
            </div>

            <div class="panel">
                <h2>Game Mode</h2>
                <div class="mode-buttons">
                    <button id="modeBtn-pvp" onclick="setMode('pvp')" aria-label="Play against another human player">Player vs Player</button>
                    <button id="modeBtn-ai" class="active" onclick="setMode('ai')" aria-label="Play against the AI">Player vs AI</button>
                </div>
                <button id="modeBtn-watch" onclick="setMode('watch')" style="margin-top: 10px;" aria-label="Watch two AIs play against each other">Watch AI vs AI</button>
            </div>

            <div class="panel">
                <h2>AI Difficulty</h2>
                <div id="singleAIDifficulty">
                    <select id="difficulty" onchange="updateDifficulty()">
                        <option value="1">Beginner (Depth 1)</option>
                        <option value="2" selected>Easy (Depth 2)</option>
                        <option value="3">Medium (Depth 3)</option>
                        <option value="4">Hard (Depth 4)</option>
                    </select>
                </div>
                <div id="watchAIDifficulty" style="display: none;">
                    <div style="margin-bottom: 10px;">
                        <label style="font-size: 13px; font-weight: bold; display: block; margin-bottom: 5px;">White AI:</label>
                        <select id="difficultyWhite" onchange="updateDifficultyWhite()">
                            <option value="1">Beginner (Depth 1)</option>
                            <option value="2" selected>Easy (Depth 2)</option>
                            <option value="3">Medium (Depth 3)</option>
                            <option value="4">Hard (Depth 4)</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size: 13px; font-weight: bold; display: block; margin-bottom: 5px;">Black AI:</label>
                        <select id="difficultyBlack" onchange="updateDifficultyBlack()">
                            <option value="1">Beginner (Depth 1)</option>
                            <option value="2" selected>Easy (Depth 2)</option>
                            <option value="3">Medium (Depth 3)</option>
                            <option value="4">Hard (Depth 4)</option>
                        </select>
                    </div>
                    <div id="watchControls" style="margin-top: 15px; display: flex; gap: 5px;">
                        <button id="startWatchBtn" onclick="startWatchMatch()" style="flex: 1; padding: 8px; font-size: 12px;">Start Match</button>
                        <button id="pauseWatchBtn" onclick="pauseWatchMatch()" style="flex: 1; padding: 8px; font-size: 12px; display: none;">Pause</button>
                        <button id="stopWatchBtn" onclick="stopWatchMatch()" style="flex: 1; padding: 8px; font-size: 12px; display: none;">Stop</button>
                    </div>
                </div>
                <div style="font-size: 11px; color: #888; margin-top: 5px;">
                    Higher depth = stronger but slower
                </div>
            </div>

            <div class="panel">
                <h2>Settings</h2>
                <div class="checkbox-container">
                    <input type="checkbox" id="showLegalMoves" checked onchange="toggleLegalMoves()">
                    <label for="showLegalMoves">Show Legal Moves</label>
                </div>
                <button onclick="newGame()" aria-label="Start a new game">New Game</button>
            </div>
        </div>
    </div>

    <!-- Load scripts in dependency order -->
    <script src="js/constants.js"></script>
    <script src="js/engine.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
